<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>æ•°å­—çš®å½±äºº Â· AI è§†é¢‘ç”Ÿæˆç³»ç»Ÿï¼ˆä¼ªï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  background: #f7e9c9;
  font-family: system-ui;
  padding: 20px;
  color: #4a3a27;
}
.container {
  max-width: 900px;
  margin: auto;
  background: #fffdf6;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.15);
}
h1 { margin-bottom: 10px; }
label { font-size: 14px; font-weight: 600; }
input { margin: 8px 0 18px; }
#log {
  background: #1b1b1b;
  color: #eee;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  height: 140px;
  overflow-y: auto;
  font-family: monospace;
  font-size: 12px;
}
#preview {
  margin-top: 20px;
  text-align: center;
}
#gif {
  max-width: 100%;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
}
button {
  padding: 12px 20px;
  margin-top: 8px;
  width: 100%;
  border: none;
  background: #d29a38;
  color: white;
  border-radius: 10px;
  font-size: 15px;
  cursor: pointer;
}
button:hover {
  background: #c28825;
}
small {
  display: block;
  font-size: 12px;
  color: #7b6a4a;
  margin-top: -12px;
  margin-bottom: 16px;
}
</style>
</head>
<body>

<div class="container">
  <h1>AI è§†é¢‘ç”Ÿæˆï¼ˆåŸºäºæ‹¼è±†è§’è‰² + AI åœºæ™¯ï¼‰</h1>
  <p>
    ä¸Šä¼ ä½ çš„æ‹¼è±†è§’è‰²å›¾ â†’ ç³»ç»Ÿè‡ªåŠ¨æå–è§’è‰²é…è‰²ï¼Œ<b>ç”Ÿæˆ AI åœºæ™¯èƒŒæ™¯</b> â†’ è‡ªåŠ¨ç”Ÿæˆ 12 å¸§åŠ¨ç”» â†’ åˆæˆ GIFï¼Œæ¨¡æ‹Ÿâ€œæ‰©æ•£æ¨¡å‹ç”Ÿæˆè§†é¢‘â€çš„å…¨è¿‡ç¨‹ã€‚
  </p>

  <label>â‘  ä¸Šä¼ æ‹¼è±†è§’è‰²</label><br>
  <input id="charImg" type="file" accept="image/*">
  <small>ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®è§’è‰²é¢œè‰²ç”ŸæˆåŠ¨æ€ AI èƒŒæ™¯ï¼Œæ— éœ€å†ä¸Šä¼ åœºæ™¯å›¾ã€‚</small>

  <button onclick="generate()">ç”Ÿæˆ AI è§†é¢‘ï¼ˆGIFï¼‰</button>

  <div id="log"></div>

  <div id="preview"></div>
</div>

<!-- gif.jsï¼Œç”¨äºå‰ç«¯åˆæˆ gif -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

<script>
// æ—¥å¿—è¾“å‡º
function log(msg) {
  const box = document.getElementById("log");
  box.innerHTML += msg + "<br>";
  box.scrollTop = box.scrollHeight;
}

// è¯»å–å›¾ç‰‡
async function loadImage(file) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = URL.createObjectURL(file);
  });
}

// ç®€å•â€œAI é…è‰²æå–â€ï¼šè®¡ç®—è§’è‰²å›¾çš„å¹³å‡é¢œè‰²
function getAverageColor(img) {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  const size = 64;
  canvas.width = size;
  canvas.height = size;

  ctx.drawImage(img, 0, 0, size, size);
  const data = ctx.getImageData(0, 0, size, size).data;

  let r = 0, g = 0, b = 0, count = 0;
  for (let i = 0; i < data.length; i += 4) {
    const alpha = data[i + 3];
    if (alpha < 40) continue; // å¿½ç•¥å¤ªé€æ˜çš„åƒç´ 
    r += data[i];
    g += data[i + 1];
    b += data[i + 2];
    count++;
  }
  if (!count) count = 1;
  r = Math.round(r / count);
  g = Math.round(g / count);
  b = Math.round(b / count);
  return { r, g, b };
}

// ç”Ÿæˆäº’è¡¥è‰²ï¼Œæ¨¡æ‹Ÿâ€œé£æ ¼è¿ç§»â€
function getComplementColor({ r, g, b }) {
  return {
    r: 255 - r,
    g: 255 - g,
    b: 255 - b
  };
}

// å¸®åŠ©å‡½æ•°ï¼šrgb â†’ CSS å­—ç¬¦ä¸²
function rgbStr({ r, g, b }, alpha = 1) {
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

async function generate() {
  const charFile = document.getElementById("charImg").files[0];

  if (!charFile) {
    log("âŒ å¿…é¡»å…ˆä¸Šä¼ è§’è‰²å›¾");
    return;
  }

  // æ¸…ç©ºä¹‹å‰ç”Ÿæˆç»“æœ
  document.getElementById("preview").innerHTML = "";
  document.getElementById("log").innerHTML = "";

  log("âœ” åŠ è½½æ‹¼è±†è§’è‰²å›¾...");
  const charImg = await loadImage(charFile);

  log("ğŸ§  æ­£åœ¨åˆ†æè§’è‰²å›¾ç‰¹å¾ï¼ˆæå–é¢œè‰²åˆ†å¸ƒ & é£æ ¼å‘é‡ï¼‰...");
  const mainColor = getAverageColor(charImg);
  const compColor = getComplementColor(mainColor);
  log(`ğŸ¨ æ£€æµ‹åˆ°è§’è‰²ä¸»è‰²ï¼šrgb(${mainColor.r}, ${mainColor.g}, ${mainColor.b})`);
  log("ğŸ› æ„å»º AI åœºæ™¯ç”Ÿæˆå™¨ï¼ˆåŸºäºè§’è‰²é…è‰² + å™ªå£°åœºï¼‰...");

  log("ğŸš€ å¼€å§‹ç”Ÿæˆå…³é”®å¸§ï¼ˆè§’è‰²åŠ¨ä½œ + AI åœºæ™¯ï¼‰...");
  const gif = new GIF({
    workers: 2,
    quality: 12
  });

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 480;
  canvas.height = 320;

  // ç”Ÿæˆ 12 å¸§
  for (let i = 0; i < 12; i++) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // === 1. AI èƒŒæ™¯ï¼šåŠ¨æ€æ¸å˜ + å…‰æ–‘ï¼Œæ¨¡æ‹Ÿæ‰©æ•£æ¨¡å‹é‡Œâ€œæµåŠ¨çš„æ½œç©ºé—´â€ ===
    const t = i / 12;
    const cx = canvas.width / 2 + Math.sin(t * Math.PI * 2) * 80;
    const cy = canvas.height / 2 + Math.cos(t * Math.PI * 2) * 60;

    const grad = ctx.createRadialGradient(
      cx, cy, 40,
      canvas.width / 2, canvas.height / 2, 380
    );
    grad.addColorStop(0, rgbStr(mainColor, 0.95));
    grad.addColorStop(0.5, rgbStr(compColor, 0.85));
    grad.addColorStop(1, "rgba(10, 10, 10, 0.9)");

    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // å åŠ ä¸€äº›â€œå™ªå£°å…‰ç‚¹â€ï¼Œçœ‹èµ·æ¥æ›´åƒ AI ç”Ÿæˆçš„æ¢¦å¢ƒåœºæ™¯
    const dots = 30;
    for (let j = 0; j < dots; j++) {
      const angle = (j / dots) * Math.PI * 2 + t * 2;
      const radius = 40 + (j * 6);
      const x = canvas.width / 2 + Math.cos(angle) * radius;
      const y = canvas.height / 2 + Math.sin(angle) * radius;
      const size = 2 + (j % 5);

      ctx.beginPath();
      ctx.fillStyle = (j % 2 === 0)
        ? rgbStr(mainColor, 0.15 + (j % 3) * 0.05)
        : rgbStr(compColor, 0.15 + (j % 3) * 0.05);
      ctx.arc(x, y, size, 0, Math.PI * 2);
      ctx.fill();
    }

    // === 2. è§’è‰²ï¼šè½»å¾®æŠ–åŠ¨ + ç»†å¾®ç¼©æ”¾ï¼Œæ¨¡æ‹Ÿâ€œAI åŠ¨ä½œç”Ÿæˆâ€ ===
    const offsetX = Math.sin(i * 0.5) * 6;
    const offsetY = Math.cos(i * 0.5) * 4;
    const scale   = 1 + Math.sin(i * 0.4) * 0.05;

    const w = charImg.width * scale * 0.8;
    const h = charImg.height * scale * 0.8;

    ctx.globalAlpha = 0.95 + Math.sin(i * 0.3) * 0.05;

    ctx.drawImage(
      charImg,
      canvas.width / 2 - w / 2 + offsetX,
      canvas.height / 2 - h / 2 + offsetY,
      w, h
    );

    ctx.globalAlpha = 1;

    gif.addFrame(canvas, { delay: 100 });
    log(`âœ” ç”Ÿæˆå…³é”®å¸§ ${i + 1}/12`);
  }

  log("ğŸ§ª AI è¡¥å¸§ä¸ä¸€è‡´æ€§ä¼˜åŒ–ä¸­ï¼ˆæ¨¡æ‹Ÿä¸­é—´å¸§æ’å€¼ï¼‰...");
  log("ğŸ æ­£åœ¨åˆæˆ GIF...");

  gif.on('finished', function(blob) {
    log("ğŸ‰ è§†é¢‘ç”Ÿæˆå®Œæˆï¼");
    const url = URL.createObjectURL(blob);
    document.getElementById("preview").innerHTML =
      `<h3>AI ç”Ÿæˆç»“æœï¼š</h3>
       <img id="gif" src="${url}">
       <br><br>
       <a download="AI-video.gif" href="${url}">
         ç‚¹å‡»ä¸‹è½½ AI-video.gif
       </a>`;
  });

  gif.render();
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>æ•°å­—çš®å½±äºº Â· AI è§†é¢‘ç”Ÿæˆç³»ç»Ÿï¼ˆä¼ªï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  background: #f7e9c9;
  font-family: system-ui;
  padding: 20px;
  color: #4a3a27;
}
.container {
  max-width: 900px;
  margin: auto;
  background: #fffdf6;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.15);
}
h1 { margin-bottom: 10px; }
label { font-size: 14px; font-weight: 600; }
input { margin: 8px 0 18px; }
#log {
  background: #1b1b1b;
  color: #eee;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  height: 140px;
  overflow-y: auto;
  font-family: monospace;
  font-size: 12px;
}
#preview {
  margin-top: 20px;
  text-align: center;
}
#gif {
  max-width: 100%;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
}
button {
  padding: 12px 20px;
  margin-top: 8px;
  width: 100%;
  border: none;
  background: #d29a38;
  color: white;
  border-radius: 10px;
  font-size: 15px;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="container">
  <h1>AI è§†é¢‘ç”Ÿæˆï¼ˆåŸºäºæ‹¼è±†è§’è‰² + åœºæ™¯ï¼‰</h1>
  <p>ä¸Šä¼ æ‹¼è±†è§’è‰²å›¾ & åœºæ™¯å›¾ â†’ è‡ªåŠ¨ç”Ÿæˆ 12 å¸§åŠ¨ç”» â†’ åˆæˆ GIF â†’ æ¨¡æ‹Ÿ AI ç”Ÿæˆçš„è§†é¢‘ã€‚</p>

  <label>â‘  ä¸Šä¼ æ‹¼è±†è§’è‰²</label><br>
  <input id="charImg" type="file" accept="image/*">

  <label>â‘¡ ä¸Šä¼ åœºæ™¯èƒŒæ™¯</label><br>
  <input id="bgImg" type="file" accept="image/*">

  <button onclick="generate()">ç”Ÿæˆ AI è§†é¢‘ï¼ˆGIFï¼‰</button>

  <div id="log"></div>

  <div id="preview"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>

<script>
function log(msg) {
  const box = document.getElementById("log");
  box.innerHTML += msg + "<br>";
  box.scrollTop = box.scrollHeight;
}

async function loadImage(file) {
  return new Promise(resolve => {
    const img = new Image();
    img.onload = () => resolve(img);
    img.src = URL.createObjectURL(file);
  });
}

async function generate() {
  const charFile = document.getElementById("charImg").files[0];
  const bgFile   = document.getElementById("bgImg").files[0];

  if (!charFile || !bgFile) {
    log("âŒ å¿…é¡»å…ˆä¸Šä¼ è§’è‰²å›¾å’ŒèƒŒæ™¯å›¾");
    return;
  }

  log("âœ” åŠ è½½æ‹¼è±†è§’è‰²å›¾...");
  const charImg = await loadImage(charFile);

  log("âœ” åŠ è½½åœºæ™¯èƒŒæ™¯å›¾...");
  const bgImg = await loadImage(bgFile);

  log("ğŸš€ å¼€å§‹ç”Ÿæˆå…³é”®å¸§...");
  const gif = new GIF({
    workers: 2,
    quality: 12
  });

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 480;
  canvas.height = 320;

  // ç”Ÿæˆ 12 å¸§
  for (let i = 0; i < 12; i++) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // èƒŒæ™¯
    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

    // è§’è‰²ï¼šè½»å¾®æŠ–åŠ¨æ¨¡æ‹Ÿâ€œAIåŠ¨ä½œâ€
    const offsetX = Math.sin(i * 0.5) * 6;
    const offsetY = Math.cos(i * 0.5) * 4;
    const scale   = 1 + Math.sin(i * 0.4) * 0.05;

    const w = charImg.width * scale * 0.8;
    const h = charImg.height * scale * 0.8;

    ctx.globalAlpha = 0.9 + Math.sin(i * 0.3) * 0.1;

    ctx.drawImage(
      charImg,
      canvas.width/2 - w/2 + offsetX,
      canvas.height/2 - h/2 + offsetY,
      w, h
    );

    ctx.globalAlpha = 1;

    gif.addFrame(canvas, { delay: 100 });
    log(`âœ” ç”Ÿæˆå…³é”®å¸§ ${i+1}/12`);
  }

  log("ğŸ§ª AI è¡¥å¸§æ¨¡æ‹Ÿä¸­...");
  log("ğŸ æ­£åœ¨åˆæˆ GIF...");

  gif.on('finished', function(blob) {
    log("ğŸ‰ è§†é¢‘ç”Ÿæˆå®Œæˆï¼");

    const url = URL.createObjectURL(blob);
    document.getElementById("preview").innerHTML =
      `<h3>AI ç”Ÿæˆç»“æœï¼š</h3>
       <img id="gif" src="${url}">
       <br><br>
       <a download="AI-video.gif" href="${url}">
         ç‚¹å‡»ä¸‹è½½ AI-video.gif
       </a>`;
  });

  gif.render();
}
</script>

</body>
</html>
